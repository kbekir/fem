%Code for Hysteric Mander Unconfined Concrete Model
clear all;
clc;
format 'compact';

% eps(1) = 0;
% stress(1) =0; 
f_c = 30;
E = 5000*sqrt(f_c);
eps_c = 0.002;
eps_u = 0.005;
% counter = 1;

eps = [0.0000
-0.0001
-0.0002
-0.0003
-0.0004
-0.0005
-0.0004
-0.0003
-0.0002
-0.0001
0.0000
0.0001
0.0002
0.0003
0.0004
0.0005
0.0004
0.0003
0.0002
0.0001
0.000083
0.0001
0.0002
0.0003
0.0004
0.0005
0.0006
0.0007
0.0008
0.0009
0.0010
0.0011
0.0012
0.0013
0.0014
0.0015
0.0016
0.0017
0.0018
0.0019
0.0020
0.0021
0.0022
0.0023
0.0022
0.0021
0.0020
0.0019
0.0018
0.0019
0.0020
0.0021
0.0022
0.0023
0.0024
0.0025
0.0026
0.0027
0.0028
0.0029
0.0030
0.0029
0.0028
0.0027
0.0026
0.0025
0.0026
0.0027
0.0028
0.0029
0.003
0.0031
0.0032
0.0033
0.0034
0.0035
0.0036
0.0037
0.0038
0.0037
0.0036
0.0035
0.0034
0.0033
0.0032
0.0031
0.003
0.0029
0.0028
0.0027
0.0026
0.0027
0.0028
0.0029
0.003
0.0031
0.0032
0.0033
0.0034
0.0035
0.0036
0.0037
0.0038
0.0039
0.004
0.0041
0.004
0.0039
0.0038
0.0037
0.0036
0.0035
0.0034
0.0033
0.0032
0.0031
0.003
0.0029
0.0028
0.0027
0.0026
0.0025
0.0024
0.0023
0.0022
0.0021
0.002
0.0019
0.0018
0.001739
0.0016
0.0015
0.0014
0.0013
0.0012
0.0013
0.0014
0.0015
0.0016
0.0017
0.0018
0.0019
0.002
0.0021
0.0022
0.0023
0.0024
0.0025
0.0026
0.0027
0.0028
0.0029
0.003
0.0031
0.0032
0.0033
0.0034
0.0035
0.0036
0.0037
0.0038
0.0039
0.004
0.0041
0.0042
0.0043
0.0042
0.0041
0.004
0.0039
0.0038
0.0037
0.0036
0.0035
0.0036
0.0037
0.0038
0.0039
0.004
0.0041
0.0042
0.0043
0.0044
0.0045
0.0046
0.0047
0.0048
0.0049];

% size(eps,1)

for i=1:size(eps,1)
    i
    eps_cur = eps(i,1)
    
    if i==1
        eps_r = eps_cur;
    elseif i>1
       eps_r = max(eps_r,eps_cur);
    end
   
    eps_ratio = eps_r/eps_c;
    
    if eps_ratio < 2
        eps_p = eps_c*(((0.145)*(eps_ratio)^2) + (0.13*eps_ratio));
    elseif eps_ratio >= 2
        eps_p = eps_c*((0.707*(eps_ratio-2) + 0.834));
    end
    
    if eps_cur < 0
        stress_cur = 0;
    elseif eps_cur == 0
        stress_cur = 0;
    elseif eps_cur > 0
        fprintf("Döngüye girdi!\n")
        r = (E/(E-(f_c/eps_c)));
        x = eps_cur/eps_c;

        if eps_cur <= 2*eps_c
           fprintf("Döngüye girdi,eps_cur<2*eps_c!\n")
           stress_cur = ((f_c)*x*r)/(r-1+x.^(r));
        elseif 2*eps_c<eps_cur
           stress_cur = (((2*f_c*r)/(r-1+2^(r)))*(eps_u-eps_cur)/(eps_u-2*eps_c));
        end

        if eps_r > eps_cur
            if eps_cur-eps_r == 0
                stress(i,1) = 0;
            elseif eps_cur-eps_r ~= 0
                stress(i,1) = stress_cur * (1+((eps_cur-eps_r)/(eps_r-eps_p)));
            end
        elseif eps_r <= eps_cur
            stress(i,1) = stress_cur;
        end
        
        if eps_cur < 0
            stress(i,1) = 0;
        end
        
        if stress(i,1) < 0
            stress(i,1) = 0;
        end   
    end
end
 
plot(eps,stress)
grid on;
ylim([-5 +35]);